<?xml version="1.0" encoding="utf-8" ?>
<config>

  <queries>
    <query name="add-root-node">
      <![CDATA[insert into m_nodes (node_title) values ({@txtqry='node_title'});

       insert into m_links (parent_link_id, parent_node_id, node_id)
        select null as parent_link_id, null as parent_node_id, @@IDENTITY as node_id
         from (select 1 as col) t;      
      ]]>
    </query>
    <query name="add-child-node">
      <![CDATA[insert into m_nodes (node_title) values ({@txtqry='node_title'});
      
      insert into m_links (parent_link_id, parent_node_id, node_id)
        select {@field='link_id'} as parent_link_id, {@field='node_id'} as parent_node_id, @@IDENTITY
         from (select 1 as col) t;
      ]]>
    </query>
    <query name="get-root-nodes">
      <![CDATA[select l.link_id, n.node_id, n.node_title 
        from m_nodes n 
        join m_links l on l.node_id = n.node_id and l.parent_link_id is null
        order by n.node_title]]>
    </query>
    <query name="get-child-nodes">
      <![CDATA[select l.link_id, n.node_id, n.node_title
        from m_links l
        join m_nodes n on n.node_id = l.node_id
        where l.parent_node_id = {@field='node_id'}
        order by n.node_title]]>
    </query>
    <query name="get-link-path">
      <![CDATA[link_path {@field='link_id'}]]>
    </query>
  </queries>

</config>