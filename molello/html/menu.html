<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="IE=9">
  <title></title>
  <link href="{@basepath}\html\bootstrap.min.css" rel="stylesheet" />
  <link href="{@basepath}\html\menu.css" rel="stylesheet" />
  <script src="{@basepath}\html\jquery-3.2.1.min.js" type="text/javascript"></script>
  <script src="{@basepath}\html\bootstrap.bundle.min.js" type="text/javascript"></script>
  <script src="{@basepath}\html\common.js" type="text/javascript"></script>
  <script language="javascript">
    $(document).ready(function () { refresh_bar(); resize_menu(); });

    $(window).on('resize', function () { resize_menu(); });

    function resize_menu() {
      var hh = $(window).height() - $("#sec-header").height() - $("#sec-footer").height();
      $("#sec-center").height(hh - 15);
    }

    function chk_checked(el) { refresh_bar(); window.event.cancelBubble = true; }

    function refresh_bar() {
      var tp = $("#tp_menu").text();

      // nodes
      if (tp == "nodes") {

        $("#img-add-node").addClass("active-ico");

        // more nodes
        if ($("img[nd-checked='true']").length || window.external.has_copied())
        { $("#img-remove-nodes").removeClass("unactive-ico").addClass("active-ico"); }
        else { $("#img-remove-nodes").addClass("unactive-ico").removeClass("active-ico"); }

        // single node
        if ($("img[nd-checked='true']").length == 1)
        { $("#img-edit-nodes").removeClass("unactive-ico").addClass("active-ico"); }
        else { $("#img-edit-nodes").addClass("unactive-ico").removeClass("active-ico"); }

        // can copy
        if (get_checked_ids() && window.external.can_copy_nodes(get_checked_ids()))
          $("#img-copy-nodes").removeClass("unactive-ico").addClass("active-ico");
        else $("#img-copy-nodes").addClass("unactive-ico").removeClass("active-ico");

        // can add copy
        if (get_checked_ids() && window.external.can_add_copy_nodes(get_checked_ids()))
          $("#img-add-copy-nodes").removeClass("unactive-ico").addClass("active-ico");
        else $("#img-add-copy-nodes").addClass("unactive-ico").removeClass("active-ico");

        // can paste links
        if (window.external.can_paste_links())
          $("#img-paste-linked").removeClass("unactive-ico").addClass("active-ico");
        else $("#img-paste-linked").addClass("unactive-ico").removeClass("active-ico");

        // can paste copy
        if (window.external.can_paste_copy())
          $("#img-paste-copy").removeClass("unactive-ico").addClass("active-ico");
        else $("#img-paste-copy").addClass("unactive-ico").removeClass("active-ico");
      }

      // items
      if (tp == "items") {
        $("#img-change-menu").addClass("active-ico");
      }
    }

    function get_checked_ids() {
      var res = "";
      $("img[nd-checked='true']").each(function (index) {
        res += (res != "" ? "," : "") + $(this).attr("chk_link_id");
      });
      return res;
    }

    function check_link_id(link_id) {
      var el = $("img[chk_link_id=" + link_id + "]");
      if (el.attr("nd-checked") == "true") el.attr("nd-checked", "false"); else el.attr("nd-checked", "true");

      if (el.attr("nd-checked") == "true") el.css("opacity", "").attr("src", $("#path_images").text() + "/check-mark-24.png");
      else el.css("opacity", "0.3").attr("src", $("#path_images").text() + "/dot-24.png");
      refresh_bar();
    }

  </script>
</head>
<body>
  <span id='tp_menu' style='display: none;'>{@field='tp_menu'}</span> 
  <span id='path_images' style='display: none;'>{@var='vars.path-images'}</span> 
  {@field='html'}
</body>
</html>
