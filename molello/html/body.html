<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="x-ua-compatible" content="IE=9">
  <link href="{@basepath}\html\bootstrap.min.css" rel="stylesheet" />
  <link href="{@basepath}\html\body.css" rel="stylesheet" />
  <script src="{@basepath}\html\jquery-3.2.1.min.js" type="text/javascript"></script>
  <script src="{@basepath}\html\bootstrap.bundle.min.js" type="text/javascript"></script>
  <script src="{@basepath}\html\common.js" type="text/javascript"></script>
  <title></title>
  <script language="javascript">
    $(document).ready(function () { });

    function i_keydown(el, ev) {
      // ALT + A
      if (ev.altKey && ev.keyCode == 65) { add_item(el, "after"); return false; }
      // ALT + P
      else if (ev.altKey && ev.keyCode == 80) { add_item(el, "before"); return false; }
      // ALT + S
      else if (ev.altKey && ev.keyCode == 83) { save_doc(); return false; }
    }

    function save_doc() { return window.external.save_items($('html')[0].outerHTML); }

    function add_item(el, where) {
      var par = $(el).parents("[i-parent='true']:first"), elc = $(el).attr("i-type") ? el : $(el).parents("[i-type]:first");
      var div = $(window.external.html_void_item($(elc).attr("i-type")));
      if (where == "after") $(par).after(div); else if (where == "before") $(par).before(div);
      if ($(div).find("*[i-subtype]:first").length > 0) $(div).find("*[i-subtype]:first").focus();
      else $(div).find("*[i-type]:first").focus();
    }

    function over_parent(el) { $(el).find("img[i-mc='true']").show(); }
    function out_parent(el) { if (!issel_item(el)) $(el).find("img[i-mc='true']").hide(); }
    function leave_parent(el) {
      $(el).find("div[i-bar='true']").css("display", "none");
      $(el).find("*[i-type]").css("opacity", "1");
    }

    function mc_omdown(el, ev) {
      var par = $(el).parents("[i-parent='true']:first");
      $(par).find("[i-dd='true']").css("display", "none");
      $(el).next("div[i-bar='true']").css("display", "none");
      $(el).nextAll("*[i-type]").css("opacity", "1");
      if (ev.button == 0) sel_unsel_item(par);
      else if (ev.button == 2) window.external.menu_items(par.attr("id"));
    }

    function mc_bmdown(el, ev, nm) {
      try {
        if (nm == "change-el") {
          var par = $(el).parents("[i-parent='true']:first");
          par.after(window.external.transform_items(par.html())).remove();
        } else if (nm == "remove") {
          var par = $(el).parents("[i-parent='true']:first"); par.remove();
          if ($("*[i-parent='true']").length == 0) {
            var div = $(window.external.html_void_item("text")); div.appendTo('body');
          }
        } else if (nm == "move-up" || nm == "move-down") {
          var par = $(el).parents("[i-parent='true']:first");
          if (nm == "move-up") {
            if (par.prev().attr("tp") == "begin") return;
            par.prev().before(par.clone()); par.remove();
          } else if (nm == "move-down") {
            if (par.next().length == 0) return;
            par.next().after(par.clone()); par.remove();
          }
          $("*[i-bar='true'],*[i-mc='true']").hide(); $("*[i-type]").css("opacity", "1");
        }
      } catch (e) { alert("errr: " + e.Message); }
    }

    function over_mc_item(el) {
      $(el).next("div[i-bar='true']").css("display", "inline");
      $(el).nextAll("*[i-type]").css("opacity", "0.4");
    }

    function out_bar(el) {
      $(el).css("display", "none");
      $(el).next("*[i-type]").css("opacity", "1");
    }

    function issel_item(el) { return $(el).attr("i-sel") == "true"; }

    function sel_unsel_item(par) {
      if (issel_item(par)) {
        par.attr("i-sel", ""); par.find("img[i-mc='true']").css("opacity", "0.3").attr("src", $("#path_images").text() + "/dot-16.png");
      }
      else {
        par.attr("i-sel", "true"); par.find("img[i-mc='true']").css("opacity", "0.6").attr("src", $("#path_images").text() + "/check-mark-red-16.png");
      }
    }
  </script>
</head>
<body>
  <div tp='begin' style='display: none'>
    <span id='path_images'>{@var='vars.path-images'}</span>
  </div>
  {@field='html'}
</body>
</html>
