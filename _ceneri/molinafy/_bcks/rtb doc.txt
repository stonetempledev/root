  public class rtb_doc : RichTextBox {

    protected static Dictionary<string, line_style> _fonts = null;

    doc _doc = null;

    public doc doc { get { return _doc; } }

    public rtb_doc (int id_doc) {

      inits();

      if (_fonts["base"].bg_color.HasValue) this.BackColor = _fonts["base"].bg_color.Value;
      if (_fonts["base"].fore_color.HasValue) this.ForeColor = _fonts["base"].fore_color.Value;
      if (_fonts["base"].font != null) this.Font = _fonts["base"].font;

      _doc = new doc(id_doc);

      parse_doc();
    }

    protected static void inits () {
      if (_fonts != null) return;
      _fonts = new Dictionary<string, line_style>();
      _fonts.Add("base", new line_style(new Font(new FontFamily("segoe ui"), 10), Color.Black, Color.White));
      _fonts.Add("title_doc", new line_style(new Font(new FontFamily("segoe ui"), 25), Color.LightSteelBlue));
      _fonts.Add("des_doc", new line_style(new Font(new FontFamily("segoe ui"), 10, FontStyle.Italic), Color.DarkGray));
    }

    #region parse

    protected string _last_style = "";
    protected void parse_doc () {
      add_line(_doc.title, "title_doc");
      add_line(_doc.des, "des_doc");
      add_line("");
      add_line("");
    }

    protected void add_line (string txt, string style = "") {
      this.AppendText((this.Lines.Count() > 0 ? Environment.NewLine : ""));
      style = style == "" ? "base" : style;
      if (_last_style != style) {
        apply_style(style);
        _last_style = style;
      }
      this.AppendText(txt);
    }

    protected void apply_style (string name) {
      if (string.IsNullOrEmpty(name)) return;
      line_style ls = _fonts[name];
      if (ls.font != null) this.SelectionFont = ls.font;
      if (ls.fore_color.HasValue) this.SelectionColor = ls.fore_color.Value;
      if (ls.bg_color.HasValue) this.SelectionBackColor = ls.bg_color.Value;
    }

    #endregion

    #region events

    protected override void OnKeyDown (KeyEventArgs e) {
      base.OnKeyDown(e);
      //e.Handled = true;
      int line = this.GetLineFromCharIndex(this.GetFirstCharIndexOfCurrentLine());
      app._main.add_war("line: " + line.ToString() + " - key code: " + e.KeyCode.ToString());

      // title_doc
      if (line == 0) {
        if (e.KeyCode == Keys.Return) e.Handled = true;
      }

      // des_doc
      if (line == 1) {
        if (e.KeyCode == Keys.Return) e.Handled = true;
      }
    }

    #endregion
  }
